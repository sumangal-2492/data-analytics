click_handler = """
    <script>
    // Define a function to handle click events
    function handleClick(event) {
        var monthNames = Object.keys(calendar.month_abbr).slice(1); // Get month names from the calendar module
        var point = event.points[0];
        var monthIndex = point.xaxis._arrayIndices[point.x];
        var selectedMonth = monthNames[monthIndex];
        var selectedYear = point.data.name.split('(')[1].split(')')[0];
        var selectedCategory = point.data.name.split(' ')[1];
        var businessUnitData = [];
        for (var i = 0; i < df.length; i++) {
            if (df[i]['Commodity_Category'] == selectedCategory && df[i]['Year'] == selectedYear && df[i]['Month'] == selectedMonth) {
                businessUnitData.push(df[i]);
            }
        }
        // Pass the data to the Python function for further processing
        var kernel = IPython.notebook.kernel;
        kernel.execute("plot_business_unit_trend('" + JSON.stringify(businessUnitData) + "')");
    }

    // Attach click event listener to the plot
    var plot = document.getElementById('notebook-container').getElementsByClassName('plotly')[0];
    plot.on('plotly_click', handleClick);
    </script>
    """

    # Display the click handler script
    display(Javascript(click_handler))
